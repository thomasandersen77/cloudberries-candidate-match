<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <!-- Indexes for relational search performance -->
    <changeSet id="20250915-01-idx-consultant-skills-consultant" author="agent">
        <createIndex tableName="consultant_skills" indexName="idx_consultant_skills_consultant">
            <column name="consultant_id"/>
        </createIndex>
    </changeSet>

    <changeSet id="20250915-02-idx-consultant-cv-consultant" author="agent">
        <createIndex tableName="consultant_cv" indexName="idx_consultant_cv_consultant">
            <column name="consultant_id"/>
        </createIndex>
    </changeSet>

    <!-- Indexes for embeddings lookup -->
    <changeSet id="20250915-03-idx-cv-embedding-provider-model" author="agent" context="pgvector">
        <createIndex tableName="cv_embedding" indexName="idx_cv_embedding_provider_model">
            <column name="provider"/>
            <column name="model"/>
        </createIndex>
    </changeSet>

    <!-- Optional cosine index, depends on pgvector installed and vector_cosine_ops available -->
    <changeSet id="20250915-04-idx-cv-embedding-ivfflat-cosine" author="agent" context="pgvector">
        <sql>
            CREATE INDEX IF NOT EXISTS idx_cv_embedding_ivfflat_cosine
                ON cv_embedding USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100);
        </sql>
    </changeSet>

</databaseChangeLog>
